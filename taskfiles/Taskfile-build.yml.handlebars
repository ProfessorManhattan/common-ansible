---
version: '3'

tasks:
{{#if hbs.docker}}
  fat:
    cmds:

  slim:
    cmds:
      - COMPRESSED_SIZE=$(docker manifest inspect -v "megabytelabs/$PACKAGE_NAME:slim" | grep size | awk -F ':' '{sum+=$NF} END {print sum}' | awk '{$1=$1/(1024^2); print $1,"MB";}')
      - sed -i "s^IMAGE_SIZE_PLACEHOLDER^ \(only ${COMPRESSED_SIZE} compressed!)^g" package.json
      - SLIM_IMAGE_SIZE=$(jq -r '.minified_image_size_human' slim.report.json)
      - sed -i "s^IMAGE_SIZE_PLACEHOLDER^ \(only ${SLIM_IMAGE_SIZE}!)^g" package.json
      - info "The slim.report.json file appears to be missing from this repository"
      - sed -i "s^IMAGE_SIZE_PLACEHOLDER^^g" package.json
      - npx prettier --write slim.report.json

{{/if}}
